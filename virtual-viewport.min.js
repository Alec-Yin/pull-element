!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.VirtualViewport=i()}(this,function(){"use strict";function t(t){for(var i=arguments,o=i.length,n=1;n<o;n++){var e=i[n];for(var r in e)t[r]=e[r]}return t}function i(t){return null!=t&&"function"==typeof t.then}function o(t){return"number"==typeof t&&!isNaN(t)}function n(t){return"[object Object]"===Object.prototype.toString.call(t)}function e(t){return"function"==typeof t}function r(i){var o=i.scrollTop,n=i.scrollLeft,e=i.offsetWidth,r=i.offsetHeight,s=i.scrollWidth,a=i.scrollHeight,h={scrollTop:o,scrollLeft:n,offsetWidth:e,offsetHeight:r,scrollWidth:s,scrollHeight:a};return t(h,l(h))}function s(i){var o=i.documentElement,n=o.clientWidth,e=o.clientHeight,r=o.scrollWidth,s=o.scrollHeight,a=i.body.scrollTop||o.scrollTop,h=i.body.scrollLeft||o.scrollLeft,c={scrollTop:a,scrollLeft:h,scrollWidth:r,scrollHeight:s,offsetWidth:n,offsetHeight:e};return t(c,l(c))}function l(t){return{isScrollTopEnd:t.scrollTop<=0,isScrollBottomEnd:t.offsetHeight+t.scrollTop>=t.scrollHeight,isScrollLeftEnd:t.scrollLeft<=0,isScrollRightEnd:t.offsetWidth+t.scrollLeft>=t.scrollWidth}}function a(t){var i="translate("+t.x+"px,"+t.y+"px)";return{transform:i,"-webkit-transform":i}}function h(t){return"string"==typeof t?document.querySelector(t):t}function c(t,i,o){t.addEventListener(i,o)}function f(t,i,o){t.removeEventListener(i,o)}function d(t){var i=t.touches?t.touches[0]:t;return{x:i.clientX,y:i.clientY}}function u(t,i){return o(t)||e(t)?t:i}function g(t,i){return e(i)?i(t):o(i)?t/i:t}function p(i){this.options=i,this.state=t({},S),this.data=null,this.props=null,this.document=null,this.target=null,this.scroller=null,this.trigger=null,this.isTouching=!1,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.animateToOrigin=this.animateToOrigin.bind(this)}var m={isScrollTopEnd:!0,isScrollLeftEnd:!0,isScrollBottomEnd:!0,isScrollRightEnd:!0},S={scrollTop:0,scrollLeft:0,scrollWidth:0,scrollHeight:0,offsetWidth:0,offsetHeight:0,isScrollTopEnd:!1,isScrollLeftEnd:!1,isScrollBottomEnd:!1,isScrollRightEnd:!1,startX:0,startY:0,moveX:0,moveY:0,offsetX:0,offsetY:0,translateX:0,translateY:0,directionX:"",directionY:"",axis:""},v={target:"body",scroller:"",trigger:"",damping:1.6,stopPropagation:!0,top:!0,bottom:!1,left:!1,right:!1,isStatic:!1,drag:!1,detectScroll:!1,transitionProperty:"transform",transitionDuration:"0.3s",transitionTimingFunction:"ease-out"};return t(p.prototype,{init:function(){var i=this.options,o=this.document=window.document,n=this.target=h(i.target),e=this.scroller=i.scroller?h(i.scroller):n;this.trigger=i.trigger?h(i.trigger):n,this.isGlobalScroller=e===o.body||e===window||e===o,this.data={},this.props=t({},v,this.options,{damping:this.getDamping()}),this.enable()},destroy:function(){this.disable(),this.props=null,this.data=null,this.document=null,this.target=null,this.scroller=null,this.trigger=null},setState:function(i){t(this.state,i)},setData:function(i){t(this.data,i)},getDamping:function(){var t=v.damping,i=this.options.damping,o=null;if(n(i))o={left:u(i.left,t),right:u(i.right,t),top:u(i.top,t),bottom:u(i.bottom,t)};else{var e=u(i,t);o={left:e,right:e,top:e,bottom:e}}return o},setTranslate:function(i,o){var n=a(i),e={transition:""};t(this.target.style,e,n,o)},animateTo:function(i,o){var n=this.props,e=a(i),r={transitionProperty:n.transitionProperty,transitionDuration:n.transitionDuration,transitionTimingFunction:n.transitionTimingFunction};t(this.target.style,r,e,o)},animateToOrigin:function(t){this.animateTo({x:0,y:0},t)},enable:function(){c(this.trigger,"touchstart",this.handleStart),c(this.document,"touchmove",this.handleMove),c(this.document,"touchend",this.handleEnd)},disable:function(){f(this.trigger,"touchstart",this.handleStart),f(this.document,"touchmove",this.handleMove),f(this.document,"touchend",this.handleEnd)},getScrollInfo:function(){var i=null;return i=this.isGlobalScroller?s(this.document):r(this.scroller),this.props.isStatic&&(i=t(i,m)),i},stopPropagationIfNeed:function(t){this.props.stopPropagation&&t.stopPropagation()},emit:function(i,o){var n=this.props[i];if(e(n)){var r=t({nativeEvent:o},this.state);return n.call(this,r)}},handleStart:function(i){if(!this.isTouching){var o=d(i);this.state=t({},S,this.getScrollInfo(),{startX:o.x,startY:o.y});var n=this.emit("onTouchStart",i);n!==!1&&(this.stopPropagationIfNeed(i),this.isTouching=!0)}},handleMove:function(t){if(this.isTouching){var i=d(t),o=this.props,n=this.state,e=n.startX,r=n.startY,s=i.x,l=i.y,a=s-e,h=l-r,c=n.axis,f=n.directionX,u=n.directionY,p=n.isScrollLeftEnd,m=n.isScrollRightEnd,S=n.isScrollTopEnd,v=n.isScrollBottomEnd;o.detectScroll&&this.setState(this.getScrollInfo()),(!p&&n.isScrollLeftEnd||!m&&n.isScrollRightEnd)&&(e=s,a=0,f="",t.preventDefault()),(!S&&n.isScrollTopEnd||!v&&n.isScrollBottomEnd)&&(r=l,h=0,u="",t.preventDefault());var T=0,E=0,y=o.damping;n.isScrollLeftEnd&&a>0?f="left":n.isScrollRightEnd&&a<0&&(f="right"),n.isScrollTopEnd&&h>0?u="top":n.isScrollBottomEnd&&h<0&&(u="bottom"),T=g(a,y[f]),E=g(h,y[f]),c||(c=Math.abs(h)>=Math.abs(a)?"y":"x"),this.setState({startX:e,startY:r,moveX:s,moveY:l,offsetX:a,offsetY:h,directionX:f,directionY:u,translateX:T,translateY:E,axis:c});var b=this.emit("onTouchMove",t);if(b!==!1&&(f||u)){if(!o.drag)if("y"===c&&o[u])T=0;else{if("x"!==c||!o[f])return;E=0}t.preventDefault(),this.setTranslate({x:T,y:E})}}},handleEnd:function(t){if(this.isTouching){this.isTouching=!1;var o=this.emit("onTouchEnd",t);if(o!==!1){var n=this.state;(n.directionX||n.directionY)&&(i(o)?o.then(this.animateToOrigin):this.animateToOrigin())}}}}),p});
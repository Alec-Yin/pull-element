!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.VirtualViewport=i()}(this,function(){"use strict";function t(t){for(var i=arguments,o=i.length,n=1;n<o;n++){var e=i[n];for(var s in e)t[s]=e[s]}return t}function i(t){return"number"==typeof t&&!isNaN(t)}function o(t){return"[object Object]"===Object.prototype.toString.call(t)}function n(t){return"function"==typeof t}function e(i){var o=i.scrollTop,n=i.scrollLeft,e=i.offsetWidth,s=i.offsetHeight,l=i.scrollWidth,h=i.scrollHeight,a={scrollTop:o,scrollLeft:n,offsetWidth:e,offsetHeight:s,scrollWidth:l,scrollHeight:h};return t(a,r(a))}function s(i){var o=i.documentElement,n=o.clientWidth,e=o.clientHeight,s=o.scrollWidth,l=o.scrollHeight,h=i.body.scrollTop||o.scrollTop,a=i.body.scrollLeft||o.scrollLeft,c={scrollTop:h,scrollLeft:a,scrollWidth:s,scrollHeight:l,offsetWidth:n,offsetHeight:e};return t(c,r(c))}function r(t){return{isScrollTopEnd:t.scrollTop<=0,isScrollBottomEnd:t.offsetHeight+t.scrollTop>=t.scrollHeight,isScrollLeftEnd:t.scrollLeft<=0,isScrollRightEnd:t.offsetWidth+t.scrollLeft>=t.scrollWidth}}function l(t){var i="translate("+t.x+"px,"+t.y+"px)";return{transform:i,webkitTransform:i}}function h(t){return"string"==typeof t?document.querySelector(t):t}function a(t,i,o){t.addEventListener(i,o)}function c(t,i,o){t.removeEventListener(i,o)}function u(t){var i=t.touches?t.touches[0]:t;return{x:i.clientX,y:i.clientY}}function f(t,o){return i(t)||n(t)?t:o}function d(t,o){return n(o)?o(t):i(o)?t/o:t}function p(i){this.options=i,this.state=t({},m),this.props=null,this.document=null,this.target=null,this.scroller=null,this.trigger=null,this.isTouching=!1,this.isPreventDefault=!1,this.isAnimateToOrigin=!1,this.preventDefault=this.preventDefault.bind(this),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this)}var g={isScrollTopEnd:!0,isScrollLeftEnd:!0,isScrollBottomEnd:!0,isScrollRightEnd:!0},m={scrollTop:0,scrollLeft:0,scrollWidth:0,scrollHeight:0,offsetWidth:0,offsetHeight:0,isScrollTopEnd:!1,isScrollLeftEnd:!1,isScrollBottomEnd:!1,isScrollRightEnd:!1,startX:0,startY:0,moveX:0,moveY:0,offsetX:0,offsetY:0,translateX:0,translateY:0,type:"",axis:""},T={target:"body",scroller:"",trigger:"",damping:1.6,stopPropagation:!0,top:!1,bottom:!1,left:!1,right:!1,isStatic:!1,drag:!1,detectScroll:!1,fixed:!0,transitionProperty:"transform",transitionDuration:"0.3s",transitionTimingFunction:"ease-out"},v="function"==typeof Promise;return t(p.prototype,{init:function(){var i=this.options,o=this.document=window.document,n=this.target=h(i.target),e=this.scroller=i.scroller?h(i.scroller):n;this.trigger=i.trigger?h(i.trigger):n,this.isGlobalScroller=e===o.body||e===window||e===o,this.props=t({},T,this.options,{damping:this.getDamping()}),this.enable()},destroy:function(){this.disable(),this.props=null,this.document=null,this.target=null,this.scroller=null,this.trigger=null},getDamping:function(){var t=T.damping,i=this.options.damping,n=null;if(o(i))n={left:f(i.left,t),right:f(i.right,t),top:f(i.top,t),bottom:f(i.bottom,t)};else{var e=f(i,t);n={left:e,right:e,top:e,bottom:e}}return n},setTranslate:function(i,o){var n=l(i),e={transition:"",webkitTransition:""};t(this.target.style,e,n,o)},animateTo:function(i,o,e){n(o)&&(e=o,o=null);var s=this,r=this.props,h=this.target,u=l(i),f={transitionProperty:r.transitionProperty,transitionDuration:r.transitionDuration,transitionTimingFunction:r.transitionTimingFunction,webkitTransitionProperty:r.transitionProperty,webkitTransitionDuration:r.transitionDuration,webkitTransitionTimingFunction:r.transitionTimingFunction},d=function(i){var n=function(t){s.handleTransitionEnd(t),e&&e(t),i&&i(t),c(h,"transitionend",n),c(h,"webkitTransitionEnd",n)};a(h,"transitionend",n),a(h,"webkitTransitionEnd",n),t(h.style,f,u,o)};return v?new Promise(d):void d()},animateToOrigin:function(t,i){return n(t)&&(i=t,t=null),this.isAnimateToOrigin=!0,this.animateTo({x:0,y:0},t,i)},enable:function(){a(this.trigger,"touchstart",this.handleTouchStart),a(this.document,"touchmove",this.handleTouchMove),a(this.document,"touchend",this.handleTouchEnd)},disable:function(){c(this.trigger,"touchstart",this.handleTouchStart),c(this.document,"touchmove",this.handleTouchMove),c(this.document,"touchend",this.handleTouchEnd)},preventDefault:function(){this.isPreventDefault=!0},getScrollInfo:function(){var i=null;return i=this.isGlobalScroller?s(this.document):e(this.scroller),this.props.isStatic&&(i=t(i,g)),i},stopPropagationIfNeed:function(t){this.props.stopPropagation&&t.stopPropagation()},detectScrollIfNeed:function(){var t=this.props;if(!t.isStatic&&t.detectScroll){var i=this.state,o=[];if(i.isScrollLeftEnd||!t.left&&!t.onPullRight||o.push("isScrollLeftEnd"),i.isScrollRightEnd||!t.right&&!t.onPullLeft||o.push("isScrollRightEnd"),i.isScrollTopEnd||!t.top&&!t.onPullDown||o.push("isScrollTopEnd"),i.isScrollBottomEnd||!t.bottom&&!t.onPullUp||o.push("isScrollBottomEnd"),o.length)for(var n=this.getScrollInfo(),e=0;e<o.length;e++){var s=o[e];i[s]=n[s]}}},setFixedStyleIfNeed:function(){var i=this.props;if(!i.isStatic&&i.fixed&&"y"===this.state.axis){var o=this.state;t(this.scroller.style,{height:o.scrollHeight+"px",overflow:"hidden"})}},clearFixedStyleIfNeed:function(){var i=this.props;!i.isStatic&&i.fixed&&"y"===this.state.axis&&t(this.scroller.style,{height:"",overflow:""})},emit:function(t,i){var o=this.props[t];if(n(o))return o.call(this,this.state,i)},handleTouchStart:function(i){if(!this.isTouching&&!this.isAnimateToOrigin){var o=u(i);this.state=t({},m,this.getScrollInfo(),{startX:o.x,startY:o.y}),this.stopPropagationIfNeed(i),this.isTouching=!0}},handleTouchMove:function(i){if(this.isTouching){var o=u(i),n=this.props,e=this.state,s=e.startX,r=e.startY,l=o.x,h=o.y,a=l-s,c=h-r,f=e.type,p=e.axis,g=e.direction,m=e.isScrollTopEnd,T=e.isScrollBottomEnd,v=e.isScrollLeftEnd,S=e.isScrollRightEnd;this.detectScrollIfNeed(),(!v&&e.isScrollLeftEnd||!S&&e.isScrollRightEnd)&&(a=0,s=l,g=f=""),(!m&&e.isScrollTopEnd||!T&&e.isScrollBottomEnd)&&(c=0,r=h,g=f=""),p||(p=Math.abs(c)>=Math.abs(a)?"y":"x"),f||("y"===p?e.isScrollTopEnd&&c>0?(g="top",f="onPullDown"):e.isScrollBottomEnd&&c<0&&(g="bottom",f="onPullUp"):"x"===p&&(e.isScrollLeftEnd&&a>0?(g="left",f="onPullRight"):e.isScrollRightEnd&&a<0&&(g="right",f="onPullLeft")));var E=n.damping,y=d(a,E[g]),b=d(c,E[g]);if(t(this.state,{startX:s,startY:r,moveX:l,moveY:h,offsetX:a,offsetY:c,translateX:y,translateY:b,direction:g,axis:p,type:f}),g){if(!n.drag)if("y"===p&&(n[f]||n[g]))y=0;else{if("x"!==p||!n[f]&&!n[g])return;b=0}if(this.emit(f,i),this.isPreventDefault)return void(this.isPreventDefault=!1);i.preventDefault(),this.setFixedStyleIfNeed(),this.setTranslate({x:y,y:b})}}},handleTouchEnd:function(t){if(this.isTouching){var i=this.state.type;return this.isTouching=!1,this.emit(i+"End",t),this.isPreventDefault?void(this.isPreventDefault=!1):void(i&&this.animateToOrigin())}},handleTransitionEnd:function(t){this.emit("onTransitionEnd",t),this.isAnimateToOrigin&&(this.isAnimateToOrigin=!1,this.emit("onOrigin",t),this.clearFixedStyleIfNeed())}}),p});
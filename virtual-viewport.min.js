!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.VirtualViewport=i()}(this,function(){"use strict";function t(t){for(var i=arguments,o=i.length,n=1;n<o;n++){var r=i[n];for(var s in r)t[s]=r[s]}return t}function i(t){return null!=t&&"function"==typeof t.then}function o(t){return"number"==typeof t&&!isNaN(t)}function n(t){return"[object Object]"===Object.prototype.toString.call(t)}function r(t){return"function"==typeof t}function s(i){var o=i.scrollTop,n=i.scrollLeft,r=i.offsetWidth,s=i.offsetHeight,e=i.scrollWidth,a=i.scrollHeight,h={scrollTop:o,scrollLeft:n,offsetWidth:r,offsetHeight:s,scrollWidth:e,scrollHeight:a};return t(h,l(h))}function e(i){var o=i.documentElement,n=o.clientWidth,r=o.clientHeight,s=o.scrollWidth,e=o.scrollHeight,a=i.body.scrollTop||o.scrollTop,h=i.body.scrollLeft||o.scrollLeft,c={scrollTop:a,scrollLeft:h,scrollWidth:s,scrollHeight:e,offsetWidth:n,offsetHeight:r};return t(c,l(c))}function l(t){return{isScrollTopEnd:t.scrollTop<=0,isScrollBottomEnd:t.offsetHeight+t.scrollTop>=t.scrollHeight,isScrollLeftEnd:t.scrollLeft<=0,isScrollRightEnd:t.offsetWidth+t.scrollLeft>=t.scrollWidth}}function a(t){var i="translate("+t.x+"px,"+t.y+"px)";return{transform:i,"-webkit-transform":i}}function h(t){return"string"==typeof t?document.querySelector(t):t}function c(t,i,o){t.addEventListener(i,o)}function d(t,i,o){t.removeEventListener(i,o)}function f(t){var i=t.touches?t.touches[0]:t;return{x:i.clientX,y:i.clientY}}function u(t,i){return o(t)||r(t)?t:i}function p(t,i){return r(i)?i(t):o(i)?t/i:t}function g(i){this.options=i,this.state=t({},S),this.data=null,this.props=null,this.document=null,this.target=null,this.scroller=null,this.trigger=null,this.isTouching=!1,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.animateToOrigin=this.animateToOrigin.bind(this)}var m={isScrollTopEnd:!0,isScrollLeftEnd:!0,isScrollBottomEnd:!0,isScrollRightEnd:!0},S={scrollTop:0,scrollLeft:0,scrollWidth:0,scrollHeight:0,offsetWidth:0,offsetHeight:0,isScrollTopEnd:!1,isScrollLeftEnd:!1,isScrollBottomEnd:!1,isScrollRightEnd:!1,startX:0,startY:0,moveX:0,moveY:0,offsetX:0,offsetY:0,translateX:0,translateY:0,directionX:"",directionY:"",axis:""},v={target:"body",scroller:"",trigger:"",damping:1.6,stopPropagation:!0,top:!0,bottom:!1,left:!1,right:!1,isStatic:!1,drag:!1,detectScroll:!1,fixed:!0,transitionProperty:"transform",transitionDuration:"0.3s",transitionTimingFunction:"ease-out"},T="function"==typeof Promise;return t(g.prototype,{init:function(){var i=this.options,o=this.document=window.document,n=this.target=h(i.target),r=this.scroller=i.scroller?h(i.scroller):n;this.trigger=i.trigger?h(i.trigger):n,this.isGlobalScroller=r===o.body||r===window||r===o,this.data={},this.props=t({},v,this.options,{damping:this.getDamping()}),this.enable()},destroy:function(){this.disable(),this.props=null,this.data=null,this.document=null,this.target=null,this.scroller=null,this.trigger=null},setState:function(i){t(this.state,i)},setData:function(i){t(this.data,i)},getDamping:function(){var t=v.damping,i=this.options.damping,o=null;if(n(i))o={left:u(i.left,t),right:u(i.right,t),top:u(i.top,t),bottom:u(i.bottom,t)};else{var r=u(i,t);o={left:r,right:r,top:r,bottom:r}}return o},setTranslate:function(i,o){var n=a(i),r={transition:"",webkitTransition:""};t(this.target.style,r,n,o)},animateTo:function(i,o,n){var r=this,s=this.props,e=this.target,l=a(i),h={transitionProperty:s.transitionProperty,transitionDuration:s.transitionDuration,transitionTimingFunction:s.transitionTimingFunction,webkitTransitionProperty:s.transitionProperty,webkitTransitionDuration:s.transitionDuration,webkitTransitionTimingFunction:s.transitionTimingFunction},f=function(i){var n=function(t){d(e,"transitionend",n),d(e,"webkitTransitionEnd",n),r.handleTransitionEnd(),i&&i(t)};c(e,"transitionend",n),c(e,"webkitTransitionEnd",n),t(this.target.style,h,l,o)};return T?new Promise(f):void f(n)},animateToOrigin:function(t,i){return this.animateTo({x:0,y:0},t,i)},handleTransitionEnd:function(t){this.emit("onTransitionEnd",t)},enable:function(){c(this.trigger,"touchstart",this.handleStart),c(this.document,"touchmove",this.handleMove),c(this.document,"touchend",this.handleEnd)},disable:function(){d(this.trigger,"touchstart",this.handleStart),d(this.document,"touchmove",this.handleMove),d(this.document,"touchend",this.handleEnd)},getScrollInfo:function(){var i=null;return i=this.isGlobalScroller?e(this.document):s(this.scroller),this.props.isStatic&&(i=t(i,m)),i},stopPropagationIfNeed:function(t){this.props.stopPropagation&&t.stopPropagation()},detectScrollIfNeed:function(){var t=this.props;if(!t.isStatic&&t.detectScroll){var i=this.state,o=[];if(!i.isScrollLeftEnd&&t.left&&o.push("isScrollLeftEnd"),!i.isScrollRightEnd&&t.right&&o.push("isScrollRightEnd"),!i.isScrollTopEnd&&t.top&&o.push("isScrollTopEnd"),!i.isScrollBottomEnd&&t.bottom&&o.push("isScrollBottomEnd"),o.length)for(var n=this.getScrollInfo(),r=0;r<o.length;r++){var s=o[r];i[s]=n[s]}}},emit:function(i,o){var n=this.props[i];if(r(n)){var s=t({nativeEvent:o},this.state);return n.call(this,s)}},handleStart:function(i){if(!this.isTouching){var o=f(i);this.state=t({},S,this.getScrollInfo(),{startX:o.x,startY:o.y});var n=this.emit("onTouchStart",i);n!==!1&&(this.stopPropagationIfNeed(i),this.isTouching=!0)}},handleMove:function(i){if(this.isTouching){var o=f(i),n=this.props,r=this.state,s=r.startX,e=r.startY,l=o.x,a=o.y,h=l-s,c=a-e,d=r.axis,u=r.directionX,g=r.directionY,m=r.isScrollTopEnd,S=r.isScrollBottomEnd,v=r.isScrollLeftEnd,T=r.isScrollRightEnd;this.detectScrollIfNeed(),(!v&&r.isScrollLeftEnd||!T&&r.isScrollRightEnd)&&(h=0,s=l),(!m&&r.isScrollTopEnd||!S&&r.isScrollBottomEnd)&&(c=0,e=a),r.isScrollLeftEnd&&h>0?u="left":r.isScrollRightEnd&&h<0&&(u="right"),r.isScrollTopEnd&&c>0?g="top":r.isScrollBottomEnd&&c<0&&(g="bottom"),d||(d=Math.abs(c)>=Math.abs(h)?"y":"x");var E=n.damping,b=p(h,E[u]),y=p(c,E[u]);this.setState({startX:s,startY:e,moveX:l,moveY:a,offsetX:h,offsetY:c,directionX:u,directionY:g,translateX:b,translateY:y,axis:d});var x=this.emit("onTouchMove",i);if(x!==!1&&(u||g)){if(!n.drag)if("y"===d&&n[g])b=0;else{if("x"!==d||!n[u])return;y=0}!n.isStatic&&n.fixed&&t(this.scroller.style,{width:r.scrollWidth+"px",height:r.scrollHeight+"px",overflow:"hidden"}),i.preventDefault(),this.setTranslate({x:b,y:y})}}},handleEnd:function(o){if(this.isTouching){this.isTouching=!1,!this.props.isStatic&&this.props.fixed&&t(this.scroller.style,{width:"",height:"",overflow:""});var n=this.emit("onTouchEnd",o);if(n!==!1){var r=this.state;(r.directionX||r.directionY)&&(i(n)?n.then(this.animateToOrigin):this.animateToOrigin())}}}}),g});